<script>
    async function analyzeDream() {
        const input = document.getElementById('dreamInput').value;
        if(!input) return;
        const btn = document.getElementById('btnText');
        btn.innerText = "EVOCAZIONE...";
        btn.disabled = true;

        // USA QUESTA CHIAVE CHE HAI APPENA GENERATO
        const API_KEY = 'AIzaSyAQdww2E3lA2qbY9Xpk7wKPkSH_vN5eyog'; 
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    contents: [{ 
                        parts: [{ text: `Analizza il sogno in italiano e rispondi SOLO JSON: {"title":"Titolo","phrase":"Sintesi","category":"Archetipo","analysis":"Interpretazione","suggestions":"Consiglio"}. Sogno: ${input}` }] 
                    }] 
                })
            });

            if (!response.ok) throw new Error();

            const json = await response.json();
            const text = json.candidates[0].content.parts[0].text;
            const cleanJson = JSON.parse(text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1));

            document.getElementById('input-section').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            document.getElementById('resTitle').innerText = cleanJson.title;
            document.getElementById('resPhrase').innerText = cleanJson.phrase;
            document.getElementById('resCategory').innerText = cleanJson.category;
            document.getElementById('resAnalysis').innerText = cleanJson.analysis;
            document.getElementById('resSugg').innerText = cleanJson.suggestions;
        } catch (error) {
            alert("Errore di connessione. Verifica che la chiave API sia attiva.");
            btn.innerText = "ANALIZZA VISIONE";
            btn.disabled = false;
        }
    }
</script>
