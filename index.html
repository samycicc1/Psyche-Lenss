
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psyche Lens - Archetypal Dream Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
            margin: 0;
            overflow-x: hidden;
        }
        h1, h2, h3, h4, .serif {
            font-family: 'Libre Baskerville', serif;
        }
        .dream-gradient {
            background: radial-gradient(circle at 50% 50%, #1e1b4b, #0f172a, #020617);
            background-attachment: fixed;
        }
        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        /* Starry Background Logic */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.5;
            animation: twinkle var(--duration) infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        .animate-fadeIn {
            animation: fadeIn 1.2s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Aurora Animation */
        @keyframes aurora-shift {
            0% { transform: translate(-10%, -10%) scale(1) rotate(0deg); opacity: 0.3; }
            33% { transform: translate(10%, 5%) scale(1.1) rotate(5deg); opacity: 0.5; }
            66% { transform: translate(-5%, 10%) scale(0.9) rotate(-3deg); opacity: 0.4; }
            100% { transform: translate(-10%, -10%) scale(1) rotate(0deg); opacity: 0.3; }
        }
        .animate-aurora {
            animation: aurora-shift 15s infinite ease-in-out;
        }

        /* Blur Reveal Animation */
        @keyframes blur-reveal {
            0% { 
                filter: blur(12px); 
                opacity: 0; 
                transform: scale(1.05); 
            }
            100% { 
                filter: blur(0); 
                opacity: 1; 
                transform: scale(1); 
            }
        }
        .letter-reveal {
            display: inline-block;
            opacity: 0;
            animation: blur-reveal 1.2s forwards;
        }

        /* Dissolve Animation for Clearing Text */
        @keyframes text-dissolve {
            0% { 
                filter: blur(0px); 
                opacity: 1; 
                transform: scale(1);
            }
            100% { 
                filter: blur(20px); 
                opacity: 0; 
                transform: scale(0.95);
            }
        }
        .dissolve-text {
            animation: text-dissolve 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards !important;
        }

        /* Archetype Glow Animation */
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.2); }
            50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.4); }
            100% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.2); }
        }
        .pulse-glow {
            animation: pulse-glow 4s infinite ease-in-out;
        }

        /* Enhanced Title Effects */
        @keyframes title-gradient-scroll {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes title-star-breath {
            0%, 100% { 
                text-shadow: 0 0 15px rgba(250, 204, 21, 0.3), 0 0 30px rgba(147, 197, 253, 0.2); 
            }
            50% { 
                text-shadow: 0 0 35px rgba(250, 204, 21, 0.7), 0 0 60px rgba(147, 197, 253, 0.5); 
            }
        }

        .title-enhanced {
            background: linear-gradient(
                to right,
                #0f172a, /* Blu Notte */
                #312e81, /* Indigo */
                #fbbf24, /* Oro Metallico */
                #d4af37, /* Oro Scuro */
                #312e81,
                #0f172a
            );
            background-size: 300% auto;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent !important;
            animation: 
                title-gradient-scroll 12s ease infinite,
                title-star-breath 6s ease-in-out infinite;
            display: inline-block;
        }

        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
          height: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.05);
          border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
          background-color: rgba(129, 140, 248, 0.3); /* indigo-300 with some opacity */
          border-radius: 10px;
          border: 2px solid rgba(255, 255, 255, 0.05);
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background-color: rgba(129, 140, 248, 0.5);
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0?pin=v135",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client?pin=v135",
    "@google/genai": "https://esm.sh/@google/genai@1.34.0?pin=v135"
  }
}
</script>
</head>
<body class="dream-gradient min-h-screen">
    <!-- Background Stars -->
    <div class="stars-container" id="stars-root"></div>
    
    <script>
        // Generate stars dynamically for better coverage and performance
        const starsContainer = document.getElementById('stars-root');
        const starCount = 150;
        
        for (let i = 0; i < starCount; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            
            const size = Math.random() * 2 + 1;
            const x = Math.random() * 100;
            const y = Math.random() * 100;
            const duration = Math.random() * 3 + 2;
            const delay = Math.random() * 5;
            
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = `${x}%`;
            star.style.top = `${y}%`;
            star.style.setProperty('--duration', `${duration}s`);
            star.style.animationDelay = `${delay}s`;
            
            // Randomly make some stars slightly blue or yellow
            const hue = Math.random() > 0.8 ? (Math.random() > 0.5 ? 210 : 50) : 0;
            if (hue > 0) {
                star.style.background = `hsl(${hue}, 80%, 90%)`;
                star.style.boxShadow = `0 0 4px hsl(${hue}, 80%, 70%)`;
            }
            
            starsContainer.appendChild(star);
        }
    </script>

    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useCallback, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI, Type } from "@google/genai";

        // services/geminiService.ts
        const API_KEY = 'AIzaSyAtoTeJ676aX2EjEMZZ58ax2FgaBqxbMx8'; // Provided API Key
        const ai = new GoogleGenAI({ apiKey: API_KEY });

        const ANALYSIS_SCHEMA = {
          type: Type.OBJECT,
          properties: {
            title: { type: Type.STRING, description: "Un titolo poetico ed evocativo per il sogno" },
            summary: { type: Type.STRING, description: "Sintesi psicologica del messaggio centrale dell'inconscio" },
            category: { 
              type: Type.STRING, 
              enum: ['Ombra', 'Intuizione', 'Emozione'],
              description: "La categoria predominante del sogno" 
            },
            emotionalClimate: {
              type: Type.ARRAY,
              items: {
                type: Type.OBJECT,
                properties: {
                  label: { type: Type.STRING },
                  percentage: { type: Type.INTEGER }
                },
                required: ["label", "percentage"]
              }
            },
            symbols: {
              type: Type.ARRAY,
              items: {
                type: Type.OBJECT,
                properties: {
                  name: { type: Type.STRING },
                  meaning: { type: Type.STRING },
                  jungianContext: { type: Type.STRING }
                },
                required: ["name", "meaning", "jungianContext"]
              }
            },
            archetypes: {
              type: Type.ARRAY,
              items: {
                type: Type.OBJECT,
                properties: {
                  name: { type: Type.STRING },
                  description: { type: Type.STRING },
                  manifestationInDream: { type: Type.STRING }
                },
                required: ["name", "description", "manifestationInDream"]
              }
            },
            deepReflection: { type: Type.STRING },
            guidingQuestion: { type: Type.STRING },
            practicalSynthesis: { type: Type.STRING }
          },
          required: ["title", "summary", "category", "emotionalClimate", "symbols", "archetypes", "deepReflection", "guidingQuestion", "practicalSynthesis"]
        };

        const SYSTEM_INSTRUCTION = `
          Sei "Psyche Lens", un Mentore Junghiano Moderno. Il tuo tono Ã¨ calmo, saggio ma estremamente accessibile e chiaro.
          
          REGOLE DI CONVERSAZIONE:
          - Spiega i termini complessi (Archetipo, Ombra, Anima) con esempi semplici presi dalla vita quotidiana.
          - Non essere eccessivamente accademico. Sii come un amico saggio che sa leggere l'anima.
          - Usa un italiano fluente e moderno.
          - Mantieni sempre il focus sul sogno dell'utente e sul suo processo di crescita (individuazione).
        `;

        async function analyzeDream(narrative) {
          const model = 'gemini-3-pro-preview';
          
          const response = await ai.models.generateContent({
            model: model,
            contents: `Analizza questo sogno: "${narrative}"`,
            config: {
              systemInstruction: SYSTEM_INSTRUCTION,
              responseMimeType: "application/json",
              responseSchema: ANALYSIS_SCHEMA,
            },
          });

          if (!response.text) throw new Error("Nessuna risposta ricevuta.");
          return JSON.parse(response.text);
        }

        async function sendChatMessage(
          narrative, 
          analysis, 
          history, 
          newMessage
        ) {
          const model = 'gemini-3-flash-preview';
          
          const chat = ai.chats.create({
            model: model,
            config: {
              systemInstruction: `${SYSTEM_INSTRUCTION} 
              Il contesto Ã¨ questo sogno: "${narrative}". 
              La tua analisi precedente era: ${JSON.stringify(analysis)}. 
              Rispondi in modo conciso ma profondo, mantenendo il dialogo aperto.`,
            },
            history: history.map(msg => ({
              role: msg.role,
              parts: [{ text: msg.text }]
            }))
          });

          const result = await chat.sendMessage({ message: newMessage });
          return result.text || "La connessione con l'inconscio si Ã¨ affievolita. Prova a ripetere il tuo pensiero.";
        }


        // components/LoadingOverlay.tsx
        const QUOTES = [
          "Chi guarda fuori sogna; chi guarda dentro si sveglia.",
          "Il sogno Ã¨ la piccola porta occulta che conduce alla parte piÃ¹ intima e segreta dell'anima.",
          "Fino a quando non renderai conscio l'inconscio, esso dirigerÃ  la tua vita e tu lo chiamerai destino.",
          "Il tuo sogno Ã¨ un dipinto dell'anima che attende di essere svelato.",
          "Nel sogno, l'anima parla un linguaggio di immagini universali.",
          "L'incontro con se stessi Ã¨, all'inizio, l'incontro con la propria ombra."
        ];

        const LoadingOverlay = () => {
          const [quoteIdx, setQuoteIdx] = useState(0);
          const [fade, setFade] = useState(true);

          useEffect(() => {
            const interval = setInterval(() => {
              setFade(false);
              setTimeout(() => {
                setQuoteIdx((prev) => (prev + 1) % QUOTES.length);
                setFade(true);
              }, 1000); // Wait for fade out
            }, 5000);
            return () => clearInterval(interval);
          }, []);

          return React.createElement(
            'div',
            { className: "fixed inset-0 bg-slate-950/95 z-[200] flex flex-col items-center justify-center p-8 backdrop-blur-xl transition-all duration-1000" },
            React.createElement(
              'div',
              { className: "relative w-48 h-48 mb-16 flex items-center justify-center" },
              React.createElement('div', { className: "absolute w-32 h-32 bg-indigo-500/10 rounded-full blur-3xl animate-pulse" }),
              React.createElement('div', { className: "absolute w-16 h-16 bg-amber-400/5 rounded-full blur-2xl animate-ping" }),
              React.createElement(
                'div',
                { className: "absolute inset-0 animate-[spin_8s_linear_infinite]" },
                [...Array(6)].map((_, i) => React.createElement('div', {
                  key: `spark1-${i}`,
                  className: "absolute w-1 h-1 bg-amber-300 rounded-full shadow-[0_0_8px_#FCD34D]",
                  style: {
                    top: '50%',
                    left: '50%',
                    transform: `rotate(${i * 60}deg) translate(60px, 0)`
                  }
                }))
              ),
              React.createElement(
                'div',
                { className: "absolute inset-0 animate-[spin_12s_linear_infinite_reverse]" },
                [...Array(8)].map((_, i) => React.createElement('div', {
                  key: `spark2-${i}`,
                  className: "absolute w-1.5 h-1.5 bg-indigo-300 rounded-full shadow-[0_0_10px_#A5B4FC] opacity-40",
                  style: {
                    top: '50%',
                    left: '50%',
                    transform: `rotate(${i * 45}deg) translate(85px, 0)`
                  }
                }))
              ),
              React.createElement(
                'div',
                { className: "relative z-10 text-amber-200 opacity-80 animate-pulse" },
                React.createElement(
                  'svg',
                  { width: "40", height: "40", viewBox: "0 0 24 24", fill: "currentColor" },
                  React.createElement('path', { d: "M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" })
                )
              )
            ),
            React.createElement(
              'div',
              { className: `max-w-2xl transition-all duration-1000 transform ${fade ? 'opacity-70 translate-y-0' : 'opacity-0 translate-y-4'}` },
              React.createElement(
                'p',
                { className: "serif text-2xl md:text-3xl text-center text-indigo-100 italic leading-relaxed font-light" },
                `"${QUOTES[quoteIdx]}"`
              )
            ),
            React.createElement(
              'div',
              { className: "mt-12 flex flex-col items-center gap-2" },
              React.createElement(
                'span',
                { className: "text-slate-600 text-[10px] uppercase tracking-[0.6em] animate-pulse" },
                "Esplorando l'Inconscio"
              ),
              React.createElement(
                'div',
                { className: "flex gap-1" },
                React.createElement('div', { className: "w-1 h-1 bg-indigo-500 rounded-full animate-bounce [animation-delay:-0.3s]" }),
                React.createElement('div', { className: "w-1 h-1 bg-indigo-500 rounded-full animate-bounce [animation-delay:-0.15s]" }),
                React.createElement('div', { className: "w-1 h-1 bg-indigo-500 rounded-full animate-bounce" })
              )
            ),
            React.createElement('style', null, `@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`)
          );
        };


        // components/SymbolCard.tsx
        const SymbolCard = ({ symbol }) => {
          return React.createElement(
            'div',
            { className: "glass-card p-6 rounded-2xl transition-all hover:scale-[1.02] border-l-4 border-indigo-400" },
            React.createElement('h4', { className: "text-xl font-bold mb-2 text-indigo-300 capitalize" }, symbol.name),
            React.createElement('p', { className: "text-slate-300 text-sm mb-3 italic" }, `"${symbol.meaning}"`),
            React.createElement(
              'div',
              { className: "text-slate-400 text-sm leading-relaxed" },
              React.createElement('span', { className: "font-semibold text-slate-300" }, "Perspective Junguiana:"),
              ` ${symbol.jungianContext}`
            )
          );
        };


        // components/ArchetypeCard.tsx
        const ArchetypeCard = ({ archetype }) => {
          return React.createElement(
            'div',
            { className: "glass-card p-6 rounded-2xl border-t-4 border-violet-500 shadow-xl pulse-glow transition-transform hover:scale-[1.01]" },
            React.createElement('h4', { className: "text-2xl font-bold mb-2 text-violet-300" }, archetype.name),
            React.createElement('p', { className: "text-slate-400 text-sm mb-4 leading-relaxed" }, archetype.description),
            React.createElement(
              'div',
              { className: "bg-slate-900/50 p-4 rounded-lg" },
              React.createElement(
                'p',
                { className: "text-indigo-200 text-sm italic leading-relaxed" },
                React.createElement('span', { className: "font-semibold text-indigo-100" }, "Presenza nel sogno:"),
                ` ${archetype.manifestationInDream}`
              )
            )
          );
        };


        // App.tsx
        const AmbientDrone = ({ active, muted }) => {
          const audioCtxRef = useRef(null);
          const gainNodeRef = useRef(null);
          const oscillatorsRef = useRef([]);
          const timeoutRef = useRef(null);

          const startAudio = useCallback(() => {
            if (!audioCtxRef.current) {
              audioCtxRef.current = new (window.AudioContext || window.webkitAudioContext)();
              gainNodeRef.current = audioCtxRef.current.createGain();
              gainNodeRef.current.connect(audioCtxRef.current.destination);
              gainNodeRef.current.gain.setValueAtTime(0, audioCtxRef.current.currentTime);
            }

            if (audioCtxRef.current.state === 'suspended') {
              audioCtxRef.current.resume();
            }

            const ctx = audioCtxRef.current;
            const masterGain = gainNodeRef.current;

            const baseFreqs = [220, 329.63, 440]; 
            baseFreqs.forEach((f, i) => {
              const osc = ctx.createOscillator();
              const filter = ctx.createBiquadFilter();
              const amp = ctx.createGain();
              osc.type = 'sine';
              osc.frequency.setValueAtTime(f, ctx.currentTime);
              filter.type = 'lowpass';
              filter.frequency.setValueAtTime(800, ctx.currentTime);
              amp.gain.setValueAtTime(0.05, ctx.currentTime);
              osc.connect(filter);
              filter.connect(amp);
              amp.connect(masterGain);
              osc.start();
              oscillatorsRef.current.push(osc);
            });

            const playChime = () => {
              if (!active || muted || !audioCtxRef.current) return;
              const chimeOsc = ctx.createOscillator();
              const chimeGain = ctx.createGain();
              const chimeFilter = ctx.createBiquadFilter();
              const frequencies = [523.25, 659.25, 783.99, 987.77, 1046.50];
              const freq = frequencies[Math.floor(Math.random() * frequencies.length)];
              chimeOsc.type = 'sine';
              chimeOsc.frequency.setValueAtTime(freq, ctx.currentTime);
              chimeFilter.type = 'lowpass';
              chimeFilter.frequency.setValueAtTime(2000, ctx.currentTime);
              chimeGain.gain.setValueAtTime(0, ctx.currentTime);
              chimeGain.gain.exponentialRampToValueAtTime(0.1, ctx.currentTime + 0.1);
              chimeGain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 4);
              chimeOsc.connect(chimeFilter);
              chimeFilter.connect(chimeGain);
              chimeGain.connect(masterGain);
              chimeOsc.start();
              chimeOsc.stop(ctx.currentTime + 4);
              timeoutRef.current = setTimeout(playChime, Math.random() * 4000 + 2000);
            };
            playChime();
          }, [active, muted]);

          const stopAudio = useCallback(() => {
            if (timeoutRef.current) clearTimeout(timeoutRef.current);
            if (gainNodeRef.current && audioCtxRef.current) {
              const ctx = audioCtxRef.current;
              gainNodeRef.current.gain.linearRampToValueAtTime(0, ctx.currentTime + 1.5);
              setTimeout(() => {
                oscillatorsRef.current.forEach(osc => { try { osc.stop(); } catch (e) {} });
                oscillatorsRef.current = [];
              }, 1600);
            }
          }, []);

          useEffect(() => {
            if (active && !muted) {
              startAudio();
              if (gainNodeRef.current && audioCtxRef.current) gainNodeRef.current.gain.linearRampToValueAtTime(0.12, audioCtxRef.current.currentTime + 2);
            } else {
              stopAudio();
            }
            return () => { if (timeoutRef.current) clearTimeout(timeoutRef.current); };
          }, [active, muted, startAudio, stopAudio]);

          return null;
        };

        const BlurTypewriter = ({ text, delayOffset = 0 }) => {
          let globalIndex = 0;
          const words = text.split(' ');
          return React.createElement(
            React.Fragment,
            null,
            words.map((word, wordIdx) => React.createElement(
              'span',
              { key: wordIdx, className: "inline-block whitespace-nowrap" },
              word.split('').map((char) => {
                const delay = (globalIndex++ * 0.05) + delayOffset;
                return React.createElement(
                  'span',
                  { key: globalIndex, className: "letter-reveal", style: { animationDelay: `${delay}s` } },
                  char
                );
              }),
              wordIdx < words.length - 1 && React.createElement('span', { className: "letter-reveal", style: { animationDelay: `${(globalIndex++ * 0.05) + delayOffset}s` } }, " ")
            ))
          );
        };

        const StarCascade = () => {
          const [particles] = useState(() => Array.from({ length: 50 }).map((_, i) => ({
            id: i, left: Math.random() * 100, size: Math.random() * 5 + 2,
            duration: Math.random() * 1.5 + 1.5, delay: Math.random() * 0.8,
            color: Math.random() > 0.4 ? '#FACC15' : '#FFFFFF', opacity: Math.random() * 0.5 + 0.5,
          })));
          return React.createElement(
            'div',
            { className: "fixed inset-0 pointer-events-none z-[100] overflow-hidden" },
            particles.map(p => React.createElement('div', {
              key: p.id, className: "absolute rounded-full shadow-lg", style: {
                left: `${p.left}%`, top: '-20px', width: `${p.size}px`, height: `${p.size}px`,
                backgroundColor: p.color, boxShadow: `0 0 ${p.size * 2}px ${p.color}`,
                opacity: p.opacity, animation: `stardust-fall ${p.duration}s cubic-bezier(0.4, 0, 0.2, 1) ${p.delay}s forwards`,
              }
            }))
          );
        };

        const App = () => {
          const [dreamNarrative, setDreamNarrative] = useState('');
          const [analysis, setAnalysis] = useState(null);
          const [isLoading, setIsLoading] = useState(false);
          const [history, setHistory] = useState([]);
          const [view, setView] = useState('input');
          const [showCascade, setShowCascade] = useState(false);
          const [copyStatus, setCopyStatus] = useState('idle');
          const [showInfo, setShowInfo] = useState(false);
          const [isDissolving, setIsDissolving] = useState(false);
          const [isMuted, setIsMuted] = useState(false);

          // Chat States
          const [chatMessages, setChatMessages] = useState([]);
          const [chatInput, setChatInput] = useState('');
          const [isChatLoading, setIsChatLoading] = useState(false);
          const chatEndRef = useRef(null);

          const textareaRef = useRef(null);

          useEffect(() => {
            const stored = localStorage.getItem('psyche_lens_history');
            if (stored) {
              try { setHistory(JSON.parse(stored)); } catch (e) { console.error("History load error", e); }
            }
          }, []);

          useEffect(() => {
            if (textareaRef.current) {
              textareaRef.current.style.height = 'auto';
              textareaRef.current.style.height = `${textareaRef.current.scrollHeight}px`;
            }
          }, [dreamNarrative]);

          useEffect(() => {
            chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          }, [chatMessages]);

          const saveToHistory = (newAnalysis, narrative) => {
            const entry = {
              id: Date.now().toString(),
              date: new Date().toLocaleDateString('it-IT', { day: 'numeric', month: 'long', year: 'numeric' }),
              narrative,
              analysis: newAnalysis
            };
            setHistory(prev => {
              const updated = [entry, ...prev];
              localStorage.setItem('psyche_lens_history', JSON.stringify(updated));
              return updated;
            });
          };

          const handleAnalyze = async () => {
            if (!dreamNarrative.trim()) return;
            setIsLoading(true);
            try {
              const result = await analyzeDream(dreamNarrative);
              setAnalysis(result);
              setChatMessages([{ role: 'model', text: `Benvenuto. Ho analizzato la tua visione. Considera questa domanda per iniziare il nostro dialogo: "${result.guidingQuestion}"` }]);
              saveToHistory(result, dreamNarrative);
              setView('result');
            } catch (err) {
              console.error(err);
            } finally {
              setIsLoading(false);
            }
          };

          const handleSendMessage = async (text) => {
            const messageToSend = text || chatInput;
            if (!messageToSend.trim() || !analysis || isChatLoading) return;

            const newUserMessage = { role: 'user', text: messageToSend };
            setChatMessages(prev => [...prev, newUserMessage]);
            setChatInput('');
            setIsChatLoading(true);

            try {
              const response = await sendChatMessage(dreamNarrative, analysis, chatMessages, messageToSend);
              setChatMessages(prev => [...prev, { role: 'model', text: response }]);
            } catch (err) {
              setChatMessages(prev => [...prev, { role: 'model', text: "Il sentiero verso l'inconscio Ã¨ momentaneamente interrotto. Riprova tra poco." }]);
            } finally {
              setIsChatLoading(false);
            }
          };

          const reset = () => {
            setDreamNarrative('');
            setAnalysis(null);
            setChatMessages([]);
            setView('input');
          };

          const getCategoryTag = (category) => {
            switch (category) {
              case 'Ombra': return { icon: 'ðŸŒ‘', label: 'Ombra', color: 'bg-slate-800 text-slate-300 border-slate-700' };
              case 'Intuizione': return { icon: 'ðŸ’¡', label: 'Intuizione', color: 'bg-amber-900/30 text-amber-200 border-amber-800/50' };
              case 'Emozione': return { icon: 'ðŸŒŠ', label: 'Emozione', color: 'bg-blue-900/30 text-blue-200 border-blue-800/50' };
              default: return { icon: 'âœ¨', label: 'Sogno', color: 'bg-indigo-900/30 text-indigo-200 border-indigo-800/50' };
            }
          };

          const getEmotionColor = (label) => {
            const l = label.toLowerCase();
            if (l.includes('ansia') || l.includes('paura')) return 'bg-rose-500/50 text-rose-100 border-rose-500/30';
            if (l.includes('meraviglia') || l.includes('gioia')) return 'bg-amber-400/50 text-amber-100 border-amber-400/30';
            if (l.includes('mistero') || l.includes('curiositÃ ')) return 'bg-violet-500/50 text-violet-100 border-violet-500/30';
            if (l.includes('pace') || l.includes('serenitÃ ')) return 'bg-emerald-400/50 text-emerald-100 border-emerald-400/30';
            return 'bg-indigo-500/50 text-indigo-100 border-indigo-500/30';
          };

          const renderInputView = () => React.createElement(
            'div',
            { className: "max-w-4xl mx-auto py-12 px-4 animate-fadeIn" },
            React.createElement(
              'div',
              { className: "text-center mb-12" },
              React.createElement(
                'h1',
                { className: "text-6xl md:text-8xl font-bold mb-10 tracking-tight italic relative inline-block px-4 title-enhanced" },
                "Psyche Lens"
              ),
              React.createElement(
                'div',
                { className: "relative max-w-2xl mx-auto py-8" },
                React.createElement(
                  'div',
                  { className: "absolute inset-0 z-0 flex items-center justify-center pointer-events-none" },
                  React.createElement('div', { className: "w-full h-full bg-gradient-to-r from-blue-600/10 via-purple-600/10 to-indigo-600/10 blur-[80px] rounded-full animate-aurora opacity-40" })
                ),
                React.createElement(
                  'div',
                  { className: "relative z-10 space-y-3" },
                  React.createElement(
                    'div',
                    { className: "text-slate-200 text-xl md:text-2xl leading-relaxed italic font-light whitespace-nowrap"-[0_2px_4px_rgba(0,0,0,0.5)] min-h-[4em]" },
                    React.createElement(BlurTypewriter, { text: "I sogni sono le stelle guida che illuminano il cammino verso la realizzazione del proprio SÃ¨." })
                  ),
                  React.createElement(
                    'div',
                    { className: "text-indigo-300 text-sm md:text-base font-medium tracking-widest opacity-80 uppercase min-h-[1.5em]" },
                    React.createElement(BlurTypewriter, { text: "â€” Carl Jung", delayOffset: 5 })
                  )
                )
              )
            ),
            React.createElement(
              'div',
              { className: "max-w-3xl mx-auto mb-16 px-4" },
              React.createElement(
                'label',
                { className: "block text-slate-400 text-xs font-bold mb-6 uppercase tracking-[0.4em] text-center opacity-70" },
                "Affida il tuo sogno alla lente"
              ),
              React.createElement(
                'div',
                { className: "relative group/input" },
                React.createElement('textarea', { ref: textareaRef, value: dreamNarrative, onChange: (e) => setDreamNarrative(e.target.value), placeholder: "Ero un'aquila che sorvolava un deserto di specchi...", className: `w-full min-h-[180px] bg-slate-900/40 text-white rounded-[20px] p-8 border border-amber-400/20 focus:border-amber-400/60 focus:shadow-[0_0_30px_rgba(251,191,36,0.15)] outline-none transition-all duration-500 resize-none text-lg leading-relaxed placeholder:text-slate-500/60 backdrop-blur-xl shadow-2xl ${isDissolving ? 'dissolve-text' : ''}` }),
                dreamNarrative && React.createElement(
                  'button',
                  { onClick: () => setDreamNarrative(''), className: "absolute bottom-5 right-6 p-2 text-amber-200/50 hover:text-amber-300 hover:scale-110 transition-all bg-white/5 rounded-full backdrop-blur-sm border border-white/5" },
                  React.createElement(
                    'svg',
                    { width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" },
                    React.createElement('path', { d: "M12 3l1.912 5.886L20 10l-6.088 1.114L12 17l-1.912-5.886L4 10l6.088-1.114L12 3z" })
                  )
                )
              ),
              React.createElement(
                'div',
                { className: "mt-12 flex flex-col items-center mb-16" },
                React.createElement(
                  'button',
                  { onClick: handleAnalyze, disabled: !dreamNarrative.trim() || isLoading, className: "group relative px-16 py-5 bg-transparent border border-indigo-400/40 hover:border-indigo-300 text-indigo-100 font-medium rounded-full transition-all active:scale-95 disabled:opacity-30 shadow-lg" },
                  React.createElement('span', { className: "relative z-10 tracking-[0.2em] uppercase text-xs font-bold" }, "Inizia l'Analisi")
                )
              ),
              React.createElement(
                'section',
                { className: "mb-12 animate-fadeIn", style: { animationDelay: '1s' } },
                React.createElement(
                  'h3',
                  { className: "text-center text-xs uppercase tracking-[0.5em] text-indigo-400/60 mb-8 font-bold" },
                  "Consigli per Sognatori"
                ),
                React.createElement(
                  'div',
                  { className: "grid md:grid-cols-3 gap-6" },
                  React.createElement(
                    'div',
                    { className: "glass-card p-6 rounded-2xl border-indigo-500/10" },
                    React.createElement('div', { className: "text-3xl mb-4" }, "âœï¸"),
                    React.createElement('h4', { className: "text-indigo-200 font-bold mb-2 serif text-lg" }, "Scrivi subito"),
                    React.createElement('p', { className: "text-slate-400 text-sm leading-relaxed" }, "Appunta il sogno appena ti svegli, i dettagli sfumano in pochi minuti.")
                  ),
                  React.createElement(
                    'div',
                    { className: "glass-card p-6 rounded-2xl border-indigo-500/10" },
                    React.createElement('div', { className: "text-3xl mb-4" }, "ðŸ”"),
                    React.createElement('h4', { className: "text-indigo-200 font-bold mb-2 serif text-lg" }, "Cerca l'emozione"),
                    React.createElement('p', { className: "text-slate-400 text-sm leading-relaxed" }, "PiÃ¹ che le immagini, conta come ti sentivi (eri felice, terrorizzato o curioso?).")
                  ),
                  React.createElement(
                    'div',
                    { className: "glass-card p-6 rounded-2xl border-indigo-500/10" },
                    React.createElement('div', { className: "text-3xl mb-4" }, "ðŸ§©"),
                    React.createElement('h4', { className: "text-indigo-200 font-bold mb-2 serif text-lg" }, "Personalizza"),
                    React.createElement('p', { className: "text-slate-400 text-sm leading-relaxed" }, "I simboli sono universali, ma il significato dipende dalla tua vita personale.")
                  )
                )
              )
            )
          );

          const renderResultView = () => {
            if (!analysis) return null;
            return React.createElement(
              'div',
              { className: "max-w-5xl mx-auto py-12 px-4 pb-32 animate-fadeIn" },
              React.createElement(
                'div',
                { className: "flex flex-wrap justify-between items-center mb-12 gap-4" },
                React.createElement(
                  'button',
                  { onClick: () => setView('input'), className: "text-slate-500 hover:text-white flex items-center gap-3 uppercase text-xs tracking-widest group" },
                  React.createElement(
                    'svg',
                    { className: "w-4 h-4 transition-transform group-hover:-translate-x-1", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
                    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15 19l-7-7 7-7" })
                  ),
                  "Nuova Visione"
                ),
                React.createElement(
                  'button',
                  { onClick: () => { navigator.clipboard.writeText(analysis.summary); setCopyStatus('copied'); setTimeout(() => setCopyStatus('idle'), 2000); }, className: "px-6 py-2 bg-indigo-500/10 hover:bg-indigo-500/30 text-indigo-200 border border-indigo-500/30 rounded-full text-[10px] uppercase tracking-widest transition-all" },
                  copyStatus === 'copied' ? "Copiato" : "Copia Analisi"
                )
              ),
              React.createElement(
                'header',
                { className: "mb-20 text-center" },
                React.createElement(
                  'div',
                  { className: "flex justify-center mb-6" },
                  React.createElement(
                    'span',
                    { className: `px-4 py-1.5 rounded-full text-[10px] uppercase tracking-[0.3em] font-bold border ${getCategoryTag(analysis.category).color}` },
                    analysis.category
                  )
                ),
                React.createElement('h2', { className: "text-4xl md:text-6xl font-bold mb-6 text-indigo-100 italic" }, analysis.title),
                React.createElement('p', { className: "text-xl md:text-2xl text-slate-400 italic leading-relaxed max-w-3xl mx-auto font-light" }, analysis.summary)
              ),
              React.createElement(
                'section',
                { className: "mb-20 max-w-2xl mx-auto" },
                React.createElement(
                  'h3',
                  { className: "text-center text-xs uppercase tracking-[0.4em] text-slate-500 mb-8 font-bold" },
                  "Clima Emotivo"
                ),
                React.createElement(
                  'div',
                  { className: "grid gap-6" },
                  analysis.emotionalClimate.map((emotion, idx) => React.createElement(
                    'div',
                    { key: idx, className: "space-y-2" },
                    React.createElement(
                      'div',
                      { className: "flex justify-between items-center text-sm" },
                      React.createElement('span', { className: "text-indigo-200" }, emotion.label),
                      React.createElement('span', { className: "text-slate-400 font-mono" }, `${emotion.percentage}%`)
                    ),
                    React.createElement(
                      'div',
                      { className: "h-2 w-full bg-slate-800/50 rounded-full overflow-hidden border border-white/5" },
                      React.createElement('div', { className: `h-full ${getEmotionColor(emotion.label).split(' ')[0]} transition-all duration-1000`, style: { width: `${emotion.percentage}%` } })
                    )
                  ))
                )
              ),
              React.createElement(
                'div',
                { className: "grid lg:grid-cols-3 gap-12 mb-20" },
                React.createElement(
                  'div',
                  { className: "lg:col-span-2 space-y-12" },
                  React.createElement('div', { className: "grid md:grid-cols-2 gap-6" }, analysis.symbols.map((s, i) => React.createElement(SymbolCard, { key: i, symbol: s }))),
                  React.createElement('div', { className: "grid gap-6" }, analysis.archetypes.map((a, i) => React.createElement(ArchetypeCard, { key: i, archetype: a })))
                ),
                React.createElement(
                  'aside',
                  null,
                  React.createElement(
                    'div',
                    { className: "glass-card p-8 rounded-3xl sticky top-8 border-indigo-500/10" },
                    React.createElement(
                      'h3',
                      { className: "text-sm uppercase tracking-[0.3em] text-slate-400 mb-6" },
                      "L'Incontro con il SÃ¨"
                    ),
                    React.createElement('p', { className: "text-slate-300 leading-loose italic" }, analysis.deepReflection),
                    React.createElement(
                      'div',
                      { className: "mt-8 pt-6 border-t border-white/5" },
                      React.createElement('p', { className: "text-amber-200/80 text-sm font-serif italic" }, `"${analysis.guidingQuestion}"`)
                    )
                  )
                )
              ),
              React.createElement(
                'section',
                { className: "max-w-4xl mx-auto mb-20" },
                React.createElement(
                  'div',
                  { className: "bg-slate-900/40 border border-indigo-500/10 rounded-[2rem] p-6 md:p-10 shadow-2xl backdrop-blur-xl" },
                  React.createElement(
                    'h3',
                    { className: "text-xs uppercase tracking-[0.6em] text-indigo-300 font-bold mb-10 text-center" },
                    "Dialogo con il Mentore"
                  ),
                  React.createElement(
                    'div',
                    { className: "space-y-6 mb-10 max-h-[500px] overflow-y-auto px-4 custom-scrollbar" },
                    chatMessages.map((msg, i) => React.createElement(
                      'div',
                      { key: i, className: `flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}` },
                      React.createElement(
                        'div',
                        { className: `max-w-[85%] p-5 rounded-2xl backdrop-blur-md border ${msg.role === 'user' ? 'bg-indigo-500/20 border-indigo-500/30 text-indigo-50' : 'bg-slate-800/40 border-slate-700/50 text-slate-200'} animate-fadeIn` },
                        React.createElement('p', { className: "text-sm md:text-base leading-relaxed italic" }, msg.text)
                      )
                    )),
                    isChatLoading && React.createElement(
                      'div',
                      { className: "flex justify-start" },
                      React.createElement('div', { className: "bg-slate-800/40 p-4 rounded-2xl animate-pulse text-indigo-300 text-xs uppercase tracking-widest" }, "Il mentore riflette...")
                    ),
                    React.createElement('div', { ref: chatEndRef })
                  ),
                  React.createElement(
                    'div',
                    { className: "space-y-6" },
                    React.createElement(
                      'div',
                      { className: "flex flex-wrap gap-2 justify-center mb-4" },
                      ['Approfondisci un simbolo', 'Collega alla mia realtÃ ', 'Come posso agire?', 'Ãˆ un messaggio positivo?'].map((chip) => React.createElement(
                        'button',
                        { key: chip, onClick: () => handleSendMessage(chip), className: "px-4 py-1.5 rounded-full border border-indigo-500/20 bg-indigo-500/5 text-indigo-300 text-[10px] uppercase tracking-widest hover:bg-indigo-500/20 hover:border-indigo-500/40 transition-all active:scale-95" },
                        chip
                      ))
                    ),
                    React.createElement(
                      'div',
                      { className: "relative group" },
                      React.createElement('input', {
                        type: "text",
                        value: chatInput,
                        onChange: (e) => setChatInput(e.target.value),
                        onKeyDown: (e) => e.key === 'Enter' && handleSendMessage(),
                        placeholder: "Approfondisci con il mentore...",
                        className: "w-full bg-slate-950/40 border border-slate-700/50 rounded-full py-4 px-8 text-white focus:border-indigo-500/50 outline-none transition-all placeholder:text-slate-600 italic"
                      }),
                      React.createElement(
                        'button',
                        { onClick: () => handleSendMessage(), disabled: !chatInput.trim() || isChatLoading, className: "absolute right-2 top-2 bottom-2 px-6 bg-indigo-500/20 hover:bg-indigo-500/40 text-indigo-200 rounded-full transition-all disabled:opacity-20" },
                        React.createElement(
                          'svg',
                          { width: "18", height: "18", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2" },
                          React.createElement('path', { d: "M5 12h14M12 5l7 7-7 7" })
                        )
                      )
                    )
                  )
                )
              ),
              React.createElement(
                'div',
                { className: "flex justify-center pt-12 border-t border-slate-800/50" },
                React.createElement(
                  'button',
                  { onClick: reset, className: "px-10 py-4 bg-indigo-900/20 hover:bg-indigo-900/40 text-indigo-200 border border-indigo-500/30 rounded-full text-sm uppercase tracking-widest" },
                  "Concludi sessione"
                )
              )
            );
          };

          const renderHistoryView = () => React.createElement(
            'div',
            { className: "max-w-5xl mx-auto py-12 px-4 animate-fadeIn" },
            React.createElement(
              'div',
              { className: "flex justify-between items-center mb-16" },
              React.createElement(
                'button',
                { onClick: () => setView('input'), className: "text-slate-500 hover:text-white flex items-center gap-3 uppercase text-xs tracking-widest group" },
                React.createElement(
                  'svg',
                  { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
                  React.createElement('path', { d: "M15 19l-7-7 7-7" })
                ),
                "Torna al Presente"
              )
            ),
            React.createElement(
              'div',
              { className: "grid md:grid-cols-2 gap-8" },
              history.map((item) => React.createElement(
                'div',
                { key: item.id, onClick: () => { setAnalysis(item.analysis); setView('result'); }, className: "glass-card p-8 rounded-[2.5rem] hover:border-indigo-500/50 cursor-pointer transition-all flex flex-col h-full" },
                React.createElement('span', { className: "text-[10px] text-slate-500 uppercase tracking-widest mb-6" }, item.date),
                React.createElement('h3', { className: "text-2xl font-bold text-white mb-4 italic leading-snug" }, item.analysis.title),
                React.createElement('p', { className: "text-slate-400 line-clamp-3 italic mb-8 flex-grow" }, `"${item.narrative}"`),
                React.createElement(
                  'div',
                  { className: "flex gap-2" },
                  React.createElement('span', { className: "px-3 py-1 rounded-full text-[9px] uppercase tracking-wider bg-indigo-500/10 border border-indigo-500/20 text-indigo-200" }, item.analysis.category)
                )
              ))
            )
          );

          const renderDictionaryView = () => React.createElement(
            'div',
            { className: "max-w-5xl mx-auto py-12 px-4 animate-fadeIn" },
            React.createElement(
              'div',
              { className: "flex justify-between items-center mb-16" },
              React.createElement(
                'button',
                { onClick: () => setView('input'), className: "text-slate-500 hover:text-white flex items-center gap-3 uppercase text-xs tracking-widest group" },
                React.createElement(
                  'svg',
                  { className: "w-4 h-4 transition-transform group-hover:-translate-x-1", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
                  React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15 19l-7-7 7-7" })
                ),
                "Torna alla Visione"
              )
            ),
            React.createElement(
              'div',
              { className: "text-center mb-16" },
              React.createElement(
                'h2',
                { className: "text-4xl font-bold text-white mb-4 tracking-tight serif italic" },
                "Piccolo Dizionario dei Simboli"
              ),
              React.createElement('div', { className: "h-px w-24 bg-indigo-500/30 mx-auto" }),
              React.createElement(
                'p',
                { className: "mt-8 text-slate-400 italic max-w-2xl mx-auto leading-relaxed text-sm" },
                "\"Il simbolo Ã¨ sempre un'espressione di qualcosa che non puÃ² essere espresso altrimenti che mediante il simbolo stesso.\""
              )
            ),
            React.createElement(
              'div',
              { className: "grid gap-6 mb-20 md:grid-cols-2 lg:grid-cols-3" },
              [
                { emoji: 'ðŸŒŠ', name: 'Acqua', desc: 'Rappresenta l\'inconscio e il fluire delle emozioni. Se Ã¨ calma indica pace, se agitata indica tempeste interiori.' },
                { emoji: 'ðŸ•Šï¸', name: 'Volare', desc: 'Simboleggia il desiderio di libertÃ , il superamento di un ostacolo o il bisogno di trascendere la realtÃ .' },
                { emoji: 'æ‰‰', name: 'Porte', desc: 'Rappresentano nuove opportunitÃ  o soglie tra diversi stati di coscienza e parti di sÃ¨.' },
                { emoji: 'ðŸŒ‘', name: 'Ombra', desc: 'Una figura oscura spesso rappresenta aspetti del carattere che non accettiamo o che ci spaventano.' },
                { emoji: 'ðŸ§©', name: 'Labirinto', desc: 'Simbolo del viaggio interiore, della ricerca del SÃ¨ attraverso la confusione della vita.' },
                { emoji: 'ðŸŒ³', name: 'Bosco', desc: 'L\'inconscio selvaggio, il luogo della prova e dell\'ignoto dove avviene la trasformazione.' },
                { emoji: 'ðŸªž', name: 'Specchio', desc: 'Rappresenta la riflessione del SÃ¨ e la necessitÃ  di guardare onestamente alla propria veritÃ .' },
                { emoji: 'ðŸ”ï¸', name: 'Montagna', desc: 'L\'ascesa verso la consapevolezza superiore e gli sforzi necessari per raggiungerla.' },
                { emoji: 'ðŸ—ï¸', name: 'Chiave', desc: 'Simboleggia la scoperta di un segreto o l\'accesso a una nuova risorsa interiore.' }
              ].map((s, i) => React.createElement(
                'div',
                { key: i, className: "glass-card p-6 rounded-2xl border-l-2 border-indigo-500/40 flex items-start gap-4 transition-all hover:bg-indigo-500/5 group" },
                React.createElement('span', { className: "text-3xl filter group-hover:scale-110 transition-transform duration-500 shrink-0" }, s.emoji),
                React.createElement(
                  'div',
                  null,
                  React.createElement('h4', { className: "text-lg font-bold text-indigo-200 mb-1 serif uppercase tracking-wider" }, s.name),
                  React.createElement('p', { className: "text-slate-400 leading-relaxed text-sm italic" }, s.desc)
                )
              ))
            ),
            React.createElement(
              'div',
              { className: "text-center mb-10" },
              React.createElement(
                'h3',
                { className: "text-2xl font-bold text-white mb-4 tracking-tight serif italic" },
                "Simbologia dei Colori"
              ),
              React.createElement('div', { className: "h-px w-16 bg-amber-400/30 mx-auto" })
            ),
            React.createElement(
              'div',
              { className: "grid gap-6 md:grid-cols-2 lg:grid-cols-4" },
              [
                { color: 'ðŸ”´', name: 'Rosso', desc: 'Passione, energia vitale, rabbia o pericolo imminente.' },
                { color: 'ðŸ”µ', name: 'Blu', desc: 'Calma, spiritualitÃ , profonditÃ  e riflessione pacata.' },
                { color: 'ðŸŸ¡', name: 'Giallo', desc: 'Luce, intelletto vigile e nuove intuizioni consce.' },
                { color: 'ðŸŸ¢', name: 'Verde', desc: 'Crescita, rigenerazione della psiche e speranza.' }
              ].map((c, i) => React.createElement(
                'div',
                { key: i, className: "glass-card p-6 rounded-2xl border-t-2 border-amber-400/20 flex flex-col items-center text-center gap-4 transition-all hover:bg-amber-400/5 group" },
                React.createElement('span', { className: "text-4xl filter group-hover:rotate-12 transition-transform duration-500" }, c.color),
                React.createElement(
                  'div',
                  null,
                  React.createElement('h4', { className: "text-md font-bold text-amber-100 mb-1 serif uppercase tracking-widest" }, c.name),
                  React.createElement('p', { className: "text-slate-400 leading-relaxed text-xs italic" }, c.desc)
                )
              ))
            ),
            React.createElement(
              'div',
              { className: "mt-20 p-10 bg-indigo-500/5 rounded-[2.5rem] border border-indigo-500/10 max-w-2xl mx-auto text-center" },
              React.createElement(
                'p',
                { className: "text-indigo-300 italic serif text-lg leading-relaxed" },
                "\"Usa questi simboli come bussole, ma ricorda che la vera mappa del tuo inconscio Ã¨ scritta con il tuo sangue e le tue lacrime.\""
              )
            )
          );

          return React.createElement(
            'div',
            { className: "min-h-screen relative overflow-x-hidden" },
            isLoading && React.createElement(LoadingOverlay, null),
            showCascade && React.createElement(StarCascade, null),
            React.createElement(AmbientDrone, { active: view === 'result', muted: isMuted }),
            showInfo && React.createElement(
              'div',
              { className: "fixed inset-0 z-[150] flex items-center justify-center p-6 bg-slate-950/80 backdrop-blur-md", onClick: () => setShowInfo(false) },
              React.createElement(
                'div',
                { className: "glass-card p-10 md:p-12 rounded-3xl max-w-2xl relative overflow-y-auto max-h-[90vh]", onClick: e => e.stopPropagation() },
                React.createElement(
                  'button',
                  { onClick: () => setShowInfo(false), className: "absolute top-4 right-4 p-2 text-slate-500 hover:text-white transition-colors" },
                  React.createElement(
                    'svg',
                    { className: "w-6 h-6", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" },
                    React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" })
                  )
                ),
                React.createElement(
                  'h2',
                  { className: "text-2xl md:text-3xl font-bold text-white mb-8 serif text-center" },
                  "Esplora Psyche Lens"
                ),
                React.createElement(
                  'div',
                  { className: "space-y-8 text-slate-300 text-sm md:text-base leading-relaxed italic" },
                  React.createElement(
                    'section',
                    { className: "bg-indigo-500/5 p-6 rounded-2xl border border-indigo-500/10" },
                    React.createElement(
                      'h3',
                      { className: "text-indigo-200 font-bold mb-4 uppercase tracking-widest text-xs" },
                      "L'Applicazione"
                    ),
                    React.createElement('p', { className: "text-slate-300 text-sm md:text-base leading-relaxed italic" }, "Psyche Lens Ã¨ il tuo portale verso l'Inconscio. Utilizziamo la psicologia archetipica per interpretare i sogni, identificando simboli universali e figure come l'Ombra, l'Anima e l'Animus.")
                  ),
                  React.createElement(
                    'section',
                    { className: "bg-slate-900/50 p-6 rounded-2xl border border-slate-700/50" },
                    React.createElement(
                      'h3',
                      { className: "text-amber-200 font-bold mb-4 uppercase tracking-widest text-xs" },
                      "Chi era Carl Gustav Jung?"
                    ),
                    React.createElement(
                      'div',
                      { className: "flex flex-col md:flex-row gap-6 items-center" },
                      React.createElement('div', { className: "w-24 h-24 rounded-full bg-slate-800 border-2 border-amber-400/20 flex items-center justify-center text-4xl shrink-0 grayscale hover:grayscale-0 transition-all duration-700" }, "ðŸ§”ðŸ»â€â™‚ï¸"),
                      React.createElement(
                        'div',
                        null,
                        React.createElement('p', { className: "mb-3" }, React.createElement('span', { className: "text-amber-100 font-bold" }, "Carl Gustav Jung (1875-1961)"), " Ã¨ stato uno psichiatra e psicoanalista svizzero, fondatore della psicologia analitica."),
                        React.createElement('p', { className: "text-slate-300 text-sm md:text-base leading-relaxed italic" }, "A differenza di Freud, Jung credeva che i sogni non fossero solo desideri repressi, ma messaggi di un ", React.createElement('span', { className: "text-amber-100" }, "Inconscio Collettivo"), " â€” un magazzino ereditario di saggezza umana espresso attraverso gli ", React.createElement('span', { className: "text-amber-100 italic" }, "Archetipi"), ".")
                      )
                    )
                  ),
                  React.createElement(
                    'p',
                    { className: "text-center text-indigo-200/60 mt-4" },
                    "Ogni sogno salvato Ã¨ un frammento prezioso del tuo processo di individuazione."
                  )
                ),
                React.createElement(
                  'div',
                  { className: "mt-10 pt-6 border-t border-white/5 text-center" },
                  React.createElement(
                    'p',
                    { className: "text-[10px] uppercase tracking-widest text-slate-500" },
                    "Versione 1.5 â€” Jungian Matrix"
                  )
                )
              )
            ),
            React.createElement(
              'nav',
              { className: "p-8 flex justify-between items-center max-w-7xl mx-auto relative z-10" },
              React.createElement(
                'div',
                { onClick: reset, className: "cursor-pointer group" },
                React.createElement(
                  'svg',
                  { width: "40", height: "40", viewBox: "0 0 24 24", fill: "#FACC15", className: "filter drop-shadow-[0_0_8px_rgba(250,204,21,0.4)] group-hover:scale-110 transition-all" },
                  React.createElement('path', { d: "M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" })
                )
              ),
              React.createElement(
                'div',
                { className: "flex items-center gap-4 md:gap-8 text-[10px] uppercase tracking-[0.3em] font-bold" },
                React.createElement(
                  'button',
                  { onClick: () => setView('input'), className: view === 'input' ? 'text-indigo-400' : 'text-slate-500 hover:text-white transition-colors' },
                  "Sogno"
                ),
                React.createElement(
                  'button',
                  { onClick: () => setView('dictionary'), className: view === 'dictionary' ? 'text-indigo-400' : 'text-slate-500 hover:text-white transition-colors' },
                  "Simboli & Colori"
                ),
                React.createElement(
                  'button',
                  { onClick: () => setView('history'), className: view === 'history' ? 'text-indigo-400' : 'text-slate-500 hover:text-white transition-colors' },
                  "Memoria"
                ),
                React.createElement(
                  'div',
                  { className: "flex items-center gap-3 ml-2" },
                  React.createElement(
                    'button',
                    {
                      onClick: () => setIsMuted(!isMuted),
                      className: `w-8 h-8 rounded-full border flex items-center justify-center transition-all ${isMuted ? 'border-rose-500/30 text-rose-400 bg-rose-500/5' : 'border-slate-700 text-slate-500 hover:text-indigo-300'}`,
                      title: isMuted ? "Attiva Audio" : "Silenzia Ambiente"
                    },
                    isMuted ? 'ðŸ”‡' : 'ðŸ”Š'
                  ),
                  React.createElement(
                    'button',
                    {
                      onClick: () => setShowInfo(true),
                      className: "w-8 h-8 rounded-full border border-slate-700 flex items-center justify-center text-slate-500 hover:text-indigo-300 hover:border-indigo-400/50 transition-all font-serif italic text-lg shadow-sm",
                      title: "Informazioni"
                    },
                    "i"
                  )
                )
              )
            ),
            React.createElement(
              'main',
              { className: "relative z-10" },
              view === 'input' && renderInputView(),
              view === 'result' && renderResultView(),
              view === 'history' && renderHistoryView(),
              view === 'dictionary' && renderDictionaryView()
            ),
            React.createElement(
              'footer',
              { className: "py-20 text-center text-slate-600 text-[10px] uppercase tracking-[0.5em] relative z-10" },
              React.createElement(
                'p',
                null,
                `Â© ${new Date().getFullYear()} Psyche Lens â€” Archetypal Dream Matrix`
              )
            )
          );
        };


        // index.tsx logic
        const rootElement = document.getElementById('root');
        if (!rootElement) {
          throw new Error("Could not find root element to mount to");
        }

        const root = ReactDOM.createRoot(rootElement);
        root.render(
          React.createElement(
            React.StrictMode,
            null,
            React.createElement(App, null)
          )
        );
    </script>
</body>
</html>
