<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psyche Lens - Analisi dei Sogni</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "@google/generative-ai": "https://esm.run/@google/generative-ai"
            }
        }
    </script>
    <style>
        body { margin: 0; background: #050510; color: white; overflow-x: hidden; font-family: sans-serif; }
        .stars-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.5; animation: twinkle var(--duration) infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // CONFIGURAZIONE CHIAVE API
        const API_KEY = "AIzaSyAtoTeJ676aX2EjEMZZ58ax2FgaBqxbMx8";
        const genAI = new GoogleGenerativeAI(API_KEY);

        const StarBackground = () => {
            const stars = Array.from({ length: 150 }).map((_, i) => ({
                id: i,
                top: `${Math.random() * 100}%`,
                left: `${Math.random() * 100}%`,
                size: `${Math.random() * 3}px`,
                duration: `${2 + Math.random() * 4}s`
            }));
            return (
                <div className="stars-container">
                    {stars.map(star => (
                        <div key={star.id} className="star" style={{
                            top: star.top, left: star.left, width: star.size, height: star.size,
                            '--duration': star.duration
                        }} />
                    ))}
                </div>
            );
        };

        const App = () => {
            const [dream, setDream] = React.useState("");
            const [result, setResult] = React.useState(null);
            const [loading, setLoading] = React.useState(false);

            const analyzeDream = async () => {
                if (!dream) return;
                setLoading(true);
                try {
                    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                    const prompt = `Analizza questo sogno dal punto di vista junghiano: ${dream}. Fornisci un titolo, un riassunto e i simboli principali.`;
                    const res = await model.generateContent(prompt);
                    setResult(res.response.text());
                } catch (error) {
                    setResult("Errore durante l'analisi. Controlla la chiave API o la connessione.");
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    <StarBackground />
                    <div className="glass p-8 rounded-2xl w-full max-w-2xl text-center">
                        <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-yellow-200 bg-clip-text text-transparent">Psyche Lens</h1>
                        <p className="mb-8 opacity-80 italic">"I sogni sono le stelle guida..."</p>
                        
                        <textarea 
                            className="w-full h-32 bg-black/30 border border-white/20 rounded-xl p-4 mb-4 focus:outline-none focus:border-purple-500 transition-all"
                            placeholder="Descrivi il tuo sogno qui..."
                            value={dream}
                            onChange={(e) => setDream(e.target.value)}
                        />
                        
                        <button 
                            onClick={analyzeDream}
                            disabled={loading}
                            className="w-full py-3 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl font-bold hover:opacity-90 transition-all disabled:opacity-50"
                        >
                            {loading ? "Analizzando..." : "AFFIDA IL TUO SOGNO ALLA LENTE"}
                        </button>

                        {result && (
                            <div className="mt-8 text-left p-4 bg-white/5 rounded-xl border border-white/10 whitespace-pre-wrap">
                                {result}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
